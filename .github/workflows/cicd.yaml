name: 'ShutterBooth Hook to Cloud Run'

env:
  PROJECT_ID: 'game-test'
  FUNCTION_NAME: 'shutterbooth-hook'

on:
  push:
    branches: [ "main" ]

jobs:

  build-and-deploy:
    runs-on: 'ubuntu-latest'
    permissions:
      contents: 'read'
      id-token: 'write'

    steps:
    - uses: 'actions/checkout@v4'

    - name: 'GCloud Auth'
      uses: 'google-github-actions/auth@v2'
      with:
        project_id: ${{ env.PROJECT_ID }}
        credentials_json: ${{ secrets.GCP_SA_KEY }}

    - name: 'GCloud Deploy'
      uses: 'google-github-actions/deploy-cloud-functions@v2'
      with:
        name: ${{ env.FUNCTION_NAME }}
        runtime: 'go121'
        https_trigger_security_level: 'secure_optional'
        entry_point: 'src/server/server.go'
        region: 'asia-southeast1'
        memory_mb: '128'